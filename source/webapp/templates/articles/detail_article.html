{% extends 'base.html' %}

{% block title %}
    <title>{{ article.title }}</title>
{% endblock %}

{% block nav %}
<li class="nav-item">
    <a class="nav-link active" aria-current="page" href="{% url 'webapp:add-article' %}">Create article</a>
</li>
<li class="nav-item">
    <a class="nav-link active" aria-current="page" href="{% url 'webapp:article-update' article.pk %}">Update article</a>
</li>
<li class="nav-item">
    <a class="nav-link active" aria-current="page" href="{% url 'webapp:article-delete' article.pk %}">Delete article</a>
</li>
<li class="nav-item">
    <a class="nav-link active" aria-current="page" href="{% url 'webapp:add-comment' article.pk %}">Create comment</a>
</li>
{% endblock %}

{% block content %}
<div class="article">
    <h1>Название - {{ article.title }}</h1>
    <p>Контент - {{ article.content }}</p>
    <p>Автор - {{ article.author }}</p>
    <p>Дата создания - {{ article.created_at }}</p>
    <p>Статус - {{ article.get_status_display }}</p>
    <hr/>
    <h5>Tags</h5>
    {% for tag in article.tags.all %}
        {% if forloop.last %} {{ tag }}. {% else %} {{ tag }}, {% endif %}
    {% endfor %}

    <h5>Комментарии</h5>
    {% for comment in comments %}
        <div class="card mb-2 p-2">
            <p>{{ comment.text }}</p>
            <p>Автор: {{ comment.author }} | Дата: {{ comment.created_at }}</p>

            {% if user.is_authenticated %}
            <div class="mt-1">
                <button class="like-btn btn btn-outline-primary"
                        data-id="{{ comment.id }}"
                        data-type="comment"
                        data-liked="{{ comment.is_liked_by_user|yesno:'true,false' }}">
                    {% if comment.is_liked_by_user %}Анлайк{% else %}Лайк{% endif %}
                </button>
                <span class="likes-count">{{ comment.likes_count }}</span>
            </div>
            {% endif %}

            <a href="{% url 'webapp:comment-update' comment.pk %}">Update</a>
            <a href="{% url 'webapp:comment-delete' comment.pk %}">Delete</a>
        </div>
    {% empty %}
        <p>No comments yet.</p>
    {% endfor %}
</div>

{% load static %}
<script src="{% static 'js/likes.js' %}"></script>
{% endblock %}
